---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

export type LoadingStrategy = 'lazy' | 'eager';

export interface GalleryItemImage {
  type: 'image';
  asset: ImageMetadata;
  alt: string;
  loading?: LoadingStrategy;
  class?: string;
}

export interface GalleryItemVideo {
  type: 'video';
  src: string;
  poster?: ImageMetadata;
  preload?: 'none' | 'metadata' | 'auto';
  class?: string;
}

export type GalleryItem = GalleryItemImage | GalleryItemVideo;

interface Props {
  items: GalleryItem[];
}

const { items } = Astro.props;
---

<div class="project-gallery">
  {items.map((item) => (
    item.type === 'image' ? (
      <Image
        src={item.asset}
        alt={item.alt}
        loading={item.loading ?? 'lazy'}
        class={['project-media', item.class].filter(Boolean).join(' ')}
      />
    ) : (
      <video
        src={item.src}
        class={['project-media', item.class].filter(Boolean).join(' ')}
        autoplay
        loop
        muted
        playsinline
        preload={item.preload ?? 'metadata'}
        poster={item.poster?.src}
      ></video>
    )
  ))}
</div>

<style>
  .project-gallery {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .project-media {
    width: 100%;
    height: auto;
    aspect-ratio: 16 / 9;
    object-fit: cover;
    background: #f5f5f5;
    display: block;
    border-radius: 4px;
  }

  @media (max-width: 768px) {
    .project-gallery {
      gap: 1rem;
    }
  }
</style>
